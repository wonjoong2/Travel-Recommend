<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <link href="/css/style.css" rel="stylesheet" type="text/css">
  <link href="/css/board/BoardList.css" rel="stylesheet" type="text/css">
</head>
<style>
  .pagination {
    display: flex;
    justify-content: center;
    margin-top: 10px;
  }

  .page-btn {
    margin: 0 5px;
    padding: 5px 10px;
    border: 1px solid #ddd;
    background-color: #f9f9f9;
    cursor: pointer;
  }

  .page-btn.active {
    font-weight: bold;
    background-color: #007bff;
    color: white;
  }
</style>
<body>
<div class="ftco-section admin-list">
  <div class="container">
    <div style="height: 10px;"></div>

    <div class="justify-content-center mb-3 pb-3">
      <div class="heading-section text-center">
        <h2>내여행 목록</h2>
      </div>
    </div>
    <div class="justify-content-center mb-3 pb-3">
      <div style="width: 100%; height: 50px;">
        <input type="button" style="float:right;" class="btn btn-primary mb-2" value="검색" onclick="apiTest()"/>
      </div>
    </div>
    <div class="bd-example-snippet bd-code-snippet">
      <div class="bd-example">
        <table class="table table-hover table-bordered">
          <thead>
          <tr>
            <th scope="col" style="width: 90px;">주소</th>
            <th scope="col" style="width: 90px;">이미지</th>
            <th scope="col" style="width: 90px;">장소</th>
          </tr>
          </thead>
          <tbody>

          </tbody>
        </table>
      </div>
      <div class="bd-example-snippet bd-code-snippet">
        <div id="pagination" class="pagination"></div>
      </div>
    </div>
  </div>
</div>
</body>
<input type="hidden" id="userSeq" th:value="${params.userSeq}">
</html>

<script>
  $(document).ready(function() {

    var params = {
      areaCode : $("#areaCode option:selected").val(),
      sigunCode : $("#sigunCode option:selected").val(),
      pageNo : "1",
      userSeq : $("#userSeq").val(),
    };
    console.log(params)
    $.ajax({
      url: '/myPage/myTravelList',
      type: 'get',
      data: params,
      dataType: 'json',
      contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
      success: function(data) {
        console.log(data.myGeneralTravelList)
        console.log(data.myGeneralTravelList)
        var list = data.myGeneralTravelList;
        // var pageNo = data.response.body.pageNo;
        // var totalCount = data.response.body.totalCount;
        renderTable(list);
        // renderPagination(pageNo, totalCount);
      },
      error: function(err) {
        console.log(err);
      },
    });
  });

  function renderTable(list) {
    console.log("========================rendrTable")
    console.log(list)
    var tbody = $("table tbody"); // <tbody> 요소 선택
    tbody.empty(); // 기존 내용을 비우기

    list.forEach(function(item) {
      var imageSrc = item.image ? item.image : '';
      var row = `
            <tr>
                <td style="text-decoration-line: underline; width: 300px; cursor:pointer;" onclick="detailBtn('${item.contentId}', '${item.contentTypeId}', '${item.place}', '${item.image}','${item.address}')">${item.address}</td>
                <td>${imageSrc ? `<img src="${imageSrc}" alt="이미지" style="width: 300px; height: 50px;">` : ''}</td>
                <td style="width: 300px;">${item.place}</td>
            </tr>
        `;
      tbody.append(row);
    });
  }

  function renderPagination(pageNo, totalCount, itemsPerPage = 10, groupSize = 10) {
    var pagination = $("#pagination");
    pagination.empty(); // 기존 버튼 제거

    var totalPages = Math.ceil(totalCount / itemsPerPage); // 총 페이지 수
    var currentGroup = Math.ceil(pageNo / groupSize); // 현재 그룹 번호
    var startPage = (currentGroup - 1) * groupSize + 1; // 현재 그룹의 첫 번째 페이지 번호
    var endPage = Math.min(startPage + groupSize - 1, totalPages); // 현재 그룹의 마지막 페이지 번호

    // 이전 그룹 버튼
    if (startPage > 1) {
      pagination.append(
              `<button class="page-btn" onclick="changePage(${startPage - 1})"><<</button>`
      );
    }

    // 현재 그룹의 페이지 버튼들
    for (var i = startPage; i <= endPage; i++) {
      var pageButton = `<button
            class="page-btn ${i === pageNo ? 'active' : ''}"
            onclick="changePage(${i})">${i}</button>`;
      pagination.append(pageButton);
    }

    // 다음 그룹 버튼
    if (endPage < totalPages) {
      pagination.append(
              `<button class="page-btn" onclick="changePage(${endPage + 1})">>></button>`
      );
    }
  }


  function changePage(newPageNo) {
    var params = {
      areaCode: $("#areaCode option:selected").val(),
      sigunCode : $("#sigunCode option:selected").val(),
      pageNo: newPageNo, // 새로운 페이지 번호
    };

    $.ajax({
      url: '/travel/api/travel-api1',
      type: 'get',
      data: params,
      dataType: 'json',
      contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
      success: function(data) {
        var list = data.response.body.items.item;
        var pageNo = data.response.body.pageNo;
        var totalCount = data.response.body.totalCount;
        renderTable(list);
        renderPagination(pageNo, totalCount);
      },
      error: function(err) {
        console.log(err);
      },
    });
  }


  function detailBtn(contentId, contentTypeId, title, firstImage,addr1){

    var params = {
      contentId: contentId,
      contentTypeId: contentTypeId,
      title : title,
      firstImage : firstImage,
      addr1 : addr1,
      hideFlag : "hide"
    };
    console.log("===================params1")
    console.log(params)
    CommonUtil.openPopup('/travel/api/travelDetail', params, '여행코스 상세', 800, 600, '');

  }


</script>
<script type="text/javascript" th:src="@{/js/commonUtil/commonUtil.js}"></script>
<script type="text/javascript" th:src="@{/js/commonUtil/common.js}"></script>